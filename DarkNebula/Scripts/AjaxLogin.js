$(function () { var a = {}; var b = function (a) { var b = a.find(".validation-summary-errors, .validation-summary-valid"); if (!b.length) { b = $('<div class="validation-summary-errors"><span>Please correct the errors and try again.</span><ul></ul></div>').prependTo(a) } return b }; var c = function (a, c) { var d = b(a).removeClass("validation-summary-valid").addClass("validation-summary-errors"); var e = $.map(c, function (a) { return "<li>" + a + "</li>" }).join(""); var f = d.find("ul").empty().append(e) }; var d = function (a) { a[0].reset(); b(a).removeClass("validation-summary-errors").addClass("validation-summary-valid") }; var e = function (a) { var b = $(this); if (!b.valid || b.valid()) { $.post(b.attr("action"), b.serializeArray()).done(function (a) { a = a || {}; if (a.success) { location = a.redirect || location.href } else if (a.errors) { c(b, a.errors) } }).error(function () { c(b, ["An unknown error happened."]) }) } a.preventDefault() }; var f = function (b, c, f) { var g = f.indexOf("?") >= 0 ? "&" : "?"; a[b] = $(); $.get(f + g + "content=1").done(function (f) { a[b] = $('<div class="modal-popup">' + f + "</div>").hide().appendTo(document.body).filter("div").dialog({ title: c.data("dialog-title"), modal: true, resizable: true, draggable: true, width: c.data("dialog-width") || 600, beforeClose: function () { d($(this).find("form")) } }).find("form").submit(e).end() }) }; var g = ["#loginLink", "#registerLink"]; $.each(g, function (b, c) { $(c).click(function (b) { var d = $(this), e = d.attr("href"); if (!a[c]) { f(c, d, e) } else { a[c].dialog("open") } b.preventDefault() }) }) })